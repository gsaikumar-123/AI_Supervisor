<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>LiveKit Agent</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;margin:20px}video,audio{max-width:100%;}</style>
  <script src="https://unpkg.com/livekit-client/dist/livekit-client.umd.js"></script>
</head>
<body>
  <h2>LiveKit Agent</h2>
  <div>
    <label>Identity <input id="identity" value="ai-agent-1"></label>
    <label style="margin-left:8px">Room <input id="room" value="aiAgent"></label>
    <button id="join">Join</button>
    <button id="leave">Leave</button>
  </div>
  <div id="status" style="margin-top:8px"></div>
  <div style="margin-top:12px">
    <div>Remote Tracks</div>
    <div id="remotes"></div>
  </div>
  <script>
    let room;
    async function join(){
      const identity = document.getElementById('identity').value;
      const roomName = document.getElementById('room').value;
      const cfg = await fetch('/api/livekit-config').then(r=>r.json());
      const r = await fetch(`/api/token?identity=${encodeURIComponent(identity)}&room=${encodeURIComponent(roomName)}`);
      if(!r.ok){ document.getElementById('status').innerText = 'Token error'; return }
      const { token } = await r.json();
      room = new LivekitClient.Room();
      room.on(LivekitClient.RoomEvent.TrackSubscribed, (track)=>{
        if(track.kind === 'video' || track.kind === 'audio'){
          const el = track.attach();
          document.getElementById('remotes').appendChild(el);
        }
      });
      await room.connect(cfg.wsUrl, token);
      document.getElementById('status').innerText = 'Connected';
    }
    function leave(){ if(room){ room.disconnect(); document.getElementById('status').innerText='Disconnected'; } }
    document.getElementById('join').onclick = join;
    document.getElementById('leave').onclick = leave;
  </script>
</body>
</html>